

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GPIO Output &mdash; Embedded Tutorials 1.0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=e5e1bfdb" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=8d563738"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../../_static/copybutton.js?v=f281be69"></script>
      <script src="../../_static/custom.js?v=5fde6192"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="GPIO Input" href="gpio_input.html" />
    <link rel="prev" title="GPIO" href="../gpio.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Embedded Tutorials
              <img src="../../_static/embedded-logo.webp" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../getting_started.html">Getting Started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../stm32_basics_tutorial.html">STM32 Basics Tutorial</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../basic_setup.html">Basic Setup</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../gpio.html">GPIO</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">GPIO Output</a></li>
<li class="toctree-l3"><a class="reference internal" href="gpio_input.html">GPIO Input</a></li>
<li class="toctree-l3"><a class="reference internal" href="gpio_ext_interrupt.html">GPIO External Interrupt</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../usb.html">USB</a></li>
<li class="toctree-l2"><a class="reference internal" href="../swd.html">SWD</a></li>
<li class="toctree-l2"><a class="reference internal" href="../uart.html">UART</a></li>
<li class="toctree-l2"><a class="reference internal" href="../timer.html">Timer</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../intermediate_tutorial.html">Intermediate Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../highlights.html">Highlights</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Embedded Tutorials</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../stm32_basics_tutorial.html">STM32 Basics Tutorial</a></li>
          <li class="breadcrumb-item"><a href="../gpio.html">GPIO</a></li>
      <li class="breadcrumb-item active">GPIO Output</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/Robotics-Club-Pulchowk/EmbeddedTutorials/blob/main/source/stm32_basics_tutorial/gpio/gpio_output.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="gpio-output">
<h1>GPIO Output<a class="headerlink" href="#gpio-output" title="Link to this heading"></a></h1>
<nav class="contents local" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#cubemx-configuration" id="id1">1. CubeMX Configuration</a></p></li>
<li><p><a class="reference internal" href="#understanding-the-project-structure" id="id2">2. Understanding the Project Structure</a></p></li>
<li><p><a class="reference internal" href="#code-to-blink-led" id="id3">3. Code to Blink LED</a></p></li>
<li><p><a class="reference internal" href="#build-and-flash" id="id4">4. Build and Flash</a></p></li>
<li><p><a class="reference internal" href="#observation" id="id5">5. Observation</a></p></li>
<li><p><a class="reference internal" href="#references" id="id6">References</a></p></li>
</ul>
</nav>
<section id="cubemx-configuration">
<h2><a class="toc-backref" href="#id1" role="doc-backlink">1. CubeMX Configuration</a><a class="headerlink" href="#cubemx-configuration" title="Link to this heading"></a></h2>
<p>Open <code class="docutils literal notranslate"><span class="pre">STM32CubeMx</span></code>. Generate basic code by assing osccillator pins, serial wire pins, configuring clock and project detail. Follow the <a class="reference external" href="../basic_setup/generate_basic_code.html">generate_basic_code</a> with:</p>
<ul class="simple">
<li><p>microcontroller: <code class="docutils literal notranslate"><span class="pre">stm32f407vgt6</span></code> or board: <code class="docutils literal notranslate"><span class="pre">STM32F407VG-DISC1</span></code></p></li>
<li><p>project name: <code class="docutils literal notranslate"><span class="pre">gpio_example</span></code></p></li>
<li><p>Toolchain/IDE: <code class="docutils literal notranslate"><span class="pre">Makefile</span></code></p></li>
</ul>
<p><strong>STM32 Discovery</strong> board have leds on pins <code class="docutils literal notranslate"><span class="pre">PD12</span></code>, <code class="docutils literal notranslate"><span class="pre">PD13</span></code>, <code class="docutils literal notranslate"><span class="pre">PD14</span></code> and <code class="docutils literal notranslate"><span class="pre">PD15</span></code>. Move to <code class="docutils literal notranslate"><span class="pre">STM32CubeMX</span> <span class="pre">Pinout</span> <span class="pre">and</span> <span class="pre">Congiguration</span></code>. Click <code class="docutils literal notranslate"><span class="pre">PD12</span></code> and select <code class="docutils literal notranslate"><span class="pre">GPIO-Output</span></code>. For Bluepill, led pin is on <code class="docutils literal notranslate"><span class="pre">PA13</span></code>. Generate code.</p>
<blockquote>
<div><a class="reference internal image-reference" href="../../_images/gpio_output_select.png"><img alt="gpio_output_select" class="align-center" src="../../_images/gpio_output_select.png" style="width: 100%;" />
</a>
</div></blockquote>
</section>
<section id="understanding-the-project-structure">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">2. Understanding the Project Structure</a><a class="headerlink" href="#understanding-the-project-structure" title="Link to this heading"></a></h2>
<p>Well, you have generated the code. Now, let’s understand the project structure.</p>
<blockquote>
<div><a class="reference internal image-reference" href="../../_images/gpio_exmp_project_structure.png"><img alt="gpio_exmp_project_structure" class="align-center" src="../../_images/gpio_exmp_project_structure.png" style="width: 100%;" />
</a>
</div></blockquote>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Core</span></code>: Contains the startup main file, peripheral files and other system configuration files.
- <code class="docutils literal notranslate"><span class="pre">Inc</span></code>: Contains the header files.
- <code class="docutils literal notranslate"><span class="pre">Src</span></code>: Contains the source files.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Drivers</span></code>: Contains the HAL library.
- <code class="docutils literal notranslate"><span class="pre">CMSIS</span></code>: Contains the Cortex Microcontroller Software Interface Standard.
- <code class="docutils literal notranslate"><span class="pre">STM32F4xx_HAL_Driver</span></code>: Contains the HAL library.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">gpio_example.ioc</span></code>: The project file. It conts configuration of the microcontroller used for <em>STM32CubeMX</em>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Makefile</span></code>: The makefile to build the project.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">startup_stm32f407xx.s</span></code>: The startup file. It contains the vector table and the reset handler.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">STM32F407VGTx_FLASH.ld</span></code>: The linker script file. It contains the memory layout of the microcontroller.</p></li>
</ul>
<p>We mostly expend time on <code class="docutils literal notranslate"><span class="pre">Core</span></code>. Since you have generated the code for GPIO, you can see <code class="docutils literal notranslate"><span class="pre">gpio.h</span></code> and <code class="docutils literal notranslate"><span class="pre">gpio.c</span></code>.</p>
</section>
<section id="code-to-blink-led">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">3. Code to Blink LED</a><a class="headerlink" href="#code-to-blink-led" title="Link to this heading"></a></h2>
<p>Open project folder. Navigate to <code class="docutils literal notranslate"><span class="pre">Core/Src/main.c</span></code>. You can see codes with lots of comments. These comments are special which allow separate user code and code generated by CubeMX.</p>
<div class="admonition danger">
<p class="admonition-title">Danger</p>
<p>You must write you code inside comment block. Begin and End are specified by <code class="docutils literal notranslate"><span class="pre">/*</span> <span class="pre">USER</span> <span class="pre">CODE</span> <span class="pre">BEGIN</span> <span class="pre">x</span> <span class="pre">*/</span></code> and <code class="docutils literal notranslate"><span class="pre">/*</span> <span class="pre">USER</span> <span class="pre">CODE</span> <span class="pre">END</span> <span class="pre">x</span> <span class="pre">*/</span></code>. Here <code class="docutils literal notranslate"><span class="pre">x</span></code> is the number. If you write outside this block, your code will be lost when you regenerate the code using CubeMX.</p>
</div>
<p>To make LED blink, move to <code class="docutils literal notranslate"><span class="pre">while</span></code> block of <cite>main()</cite>. You can use the following code:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/* Infinite loop */</span>
<span class="cm">/* USER CODE BEGIN WHILE */</span>
<span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">HAL_GPIO_WritePin</span><span class="p">(</span><span class="n">GPIOD</span><span class="p">,</span><span class="w"> </span><span class="n">GPIO_PIN_12</span><span class="p">,</span><span class="w"> </span><span class="n">GPIO_PIN_SET</span><span class="p">);</span>
<span class="w">  </span><span class="n">HAL_Delay</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
<span class="w">  </span><span class="n">HAL_GPIO_WritePin</span><span class="p">(</span><span class="n">GPIOD</span><span class="p">,</span><span class="w"> </span><span class="n">GPIO_PIN_12</span><span class="p">,</span><span class="w"> </span><span class="n">GPIO_PIN_RESET</span><span class="p">);</span>
<span class="w">  </span><span class="n">HAL_Delay</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
<span class="w">  </span><span class="cm">/* USER CODE END WHILE */</span>

<span class="w">  </span><span class="cm">/* USER CODE BEGIN 3 */</span>
<span class="p">}</span>
<span class="cm">/* USER CODE END 3 */</span>
</pre></div>
</div>
<p>Let’s understand the code:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">HAL_GPIO_WritePin(GPIOD,</span> <span class="pre">GPIO_PIN_12,</span> <span class="pre">GPIO_PIN_SET)</span></code>: Sets the pin <code class="docutils literal notranslate"><span class="pre">PD12</span></code> high.  Green led turns on.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">HAL_Delay(1000)</span></code>: Delays the execution for 1000ms. Green led keeps turning on for 1s.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">HAL_GPIO_WritePin(GPIOD,</span> <span class="pre">GPIO_PIN_12,</span> <span class="pre">GPIO_PIN_RESET)</span></code>: Sets the pin <code class="docutils literal notranslate"><span class="pre">PD12</span></code> low. Green led turns off.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">HAL_Delay(1000)</span></code>: Delays the execution for 1000ms. Green leed keeps turning off for 1s.</p></li>
</ul>
<p>Therefore, the LED will blink with 1s delay.</p>
<p>You can also use <code class="docutils literal notranslate"><span class="pre">HAL_GPIO_TogglePin(GPIOD,</span> <span class="pre">GPIO_PIN_12)</span></code> to toggle the pin state.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">`Bluepill`</span></code> board have led on pin <code class="docutils literal notranslate"><span class="pre">PC13</span></code> which is active low. It means, on <code class="docutils literal notranslate"><span class="pre">GPIO_PIN_SET</span></code> led will be off and on <code class="docutils literal notranslate"><span class="pre">GPIO_PIN_RESET</span></code> led will be on.</p>
</div>
</section>
<section id="build-and-flash">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">4. Build and Flash</a><a class="headerlink" href="#build-and-flash" title="Link to this heading"></a></h2>
<p>We need to add few line of code in the makefile to flash the code. Open <code class="docutils literal notranslate"><span class="pre">Makefile</span></code> and add the following lines at the bottom:</p>
<div class="highlight-make notranslate"><div class="highlight"><pre><span></span><span class="c">#######################################</span>
<span class="c"># flash</span>
<span class="c">#######################################</span>
<span class="nf">flash</span><span class="o">:</span><span class="w"> </span><span class="k">$(</span><span class="nv">BUILD_DIR</span><span class="k">)</span>/<span class="k">$(</span><span class="nv">TARGET</span><span class="k">)</span>.<span class="n">bin</span>
<span class="w">     </span>st-flash<span class="w"> </span>--reset<span class="w"> </span>write<span class="w"> </span><span class="k">$(</span>BUILD_DIR<span class="k">)</span>/<span class="k">$(</span>TARGET<span class="k">)</span>.bin<span class="w"> </span>0x8000000
</pre></div>
</div>
<p>Now, build and flash the code.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>make<span class="w"> </span>-j
make<span class="w"> </span>flash
</pre></div>
</div>
<p>This code only works with <code class="docutils literal notranslate"><span class="pre">ST-Link</span></code>. If you are using <code class="docutils literal notranslate"><span class="pre">JLink</span></code>, see <a class="reference external" href="../basic_setup/build_using_makefile.html">build_using_makefile</a> and <a class="reference external" href="../basic_setup/flash_using_makefile.html">flash_using_makefile</a>.</p>
<p>We will continue it for <a class="reference external" href="gpio_input.html">gpio input</a>.</p>
</section>
<section id="observation">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">5. Observation</a><a class="headerlink" href="#observation" title="Link to this heading"></a></h2>
<p>See LED blinking every second. Change delay time and enjoy.</p>
</section>
<section id="references">
<h2><a class="toc-backref" href="#id6" role="doc-backlink">References</a><a class="headerlink" href="#references" title="Link to this heading"></a></h2>
<p>References are from <code class="docutils literal notranslate"><span class="pre">STM32</span> <span class="pre">HAL</span> <span class="pre">Driver</span></code> documentation.</p>
<dl class="py function">
<dt class="sig sig-object py" id="HAL_GPIO_WritePin">
<span class="sig-name descname"><span class="pre">HAL_GPIO_WritePin</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">GPIOx</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">GPIO_Pin</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">PinState</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#HAL_GPIO_WritePin" title="Link to this definition"></a></dt>
<dd><p>Sets or clears the selected data port bit.</p>
<p><strong>Note:</strong>
This function uses the GPIOx_BSRR register to allow atomic read/modify accesses.
There is no risk of an IRQ occurring between the read and modify access.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>GPIOx</strong> (<em>GPIO_TypeDef</em>) – GPIO peripheral where <cite>x</cite> can be:
- (A..K) for STM32F429X devices
- (A..I) for STM32F40XX and STM32F427X devices</p></li>
<li><p><strong>GPIO_Pin</strong> (<em>uint16_t</em>) – Specifies the port bit to be written. Can be one of the following:
- <code class="docutils literal notranslate"><span class="pre">GPIO_PIN_0</span></code> through <code class="docutils literal notranslate"><span class="pre">GPIO_PIN_15</span></code></p></li>
<li><p><strong>PinState</strong> (<em>GPIO_PinState</em>) – Specifies the value to be written to the selected bit.
Can be one of the following:
- <code class="docutils literal notranslate"><span class="pre">GPIO_PIN_RESET</span></code>: Clears the port pin
- <code class="docutils literal notranslate"><span class="pre">GPIO_PIN_SET</span></code>: Sets the port pin</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="HAL_GPIO_TogglePin">
<span class="sig-name descname"><span class="pre">HAL_GPIO_TogglePin</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">GPIOx</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">GPIO_Pin</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#HAL_GPIO_TogglePin" title="Link to this definition"></a></dt>
<dd><p>Toggles the state of the specified GPIO pins.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>GPIOx</strong> (<em>GPIO_TypeDef*</em>) – GPIO peripheral where <cite>x</cite> can be:
- (A..K) for STM32F429X devices
- (A..I) for STM32F40XX and STM32F427X devices.</p></li>
<li><p><strong>GPIO_Pin</strong> (<em>uint16_t</em>) – Specifies the pins to be toggled. This parameter can be a combination of GPIO_PIN_x values where <cite>x</cite> can range from 0 to 15.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>None</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="HAL_Delay">
<span class="sig-name descname"><span class="pre">HAL_Delay</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Delay</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#HAL_Delay" title="Link to this definition"></a></dt>
<dd><p>Provides a minimum delay (in milliseconds) based on a variable that is incremented regularly.</p>
<p><strong>Note 1:</strong>
In the default implementation, the SysTick timer is used as the time base. It generates interrupts at regular time intervals, where <cite>uwTick</cite> is incremented.</p>
<p><strong>Note 2:</strong>
This function is declared as <cite>__weak</cite> to allow overriding by user implementations in other files.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>Delay</strong> (<em>uint32_t</em>) – Specifies the delay time length, in milliseconds.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>None</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
</dd></dl>

</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../gpio.html" class="btn btn-neutral float-left" title="GPIO" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="gpio_input.html" class="btn btn-neutral float-right" title="GPIO Input" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Robotics Club, Pulchowk Campus.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>